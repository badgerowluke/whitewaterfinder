parameters:
- name: 'storageAccountType'
  type: string
  default: ''
  
- name: 'region'
  type: string
  default: 'North Central US'  

- name: 'resourceGroup'
  type: string
  default: ''  

- name: 'sharedRg'
  type: string
  default: ''

- name: 'appName'
  type: string
  default: ''

- name: 'storageAccountName'
  type: string
  default: ''  

- name: 'principal'
  type: string
  default: ''    


steps:
- task: AzureResourceGroupDeployment@2
  displayName: 'Deploy Shared Azure Resources'
  inputs:
    azureSubscription: '${{ parameters.principal }}'
    resourceGroupName: '${{parameters.resourceGroup}}'
    location: '${{parameters.region}}'
    csmFile: '$(Pipeline.Workspace)/infra/storage/sharedresources.json'
    csmParametersFile: '$(Pipeline.Workspace)/infra/storage/sharedresourcesparams.json'
    overrideParameters: '-storageAccountType "${{parameters.storageAccountType}}" -appName "${{parameters.appName}}" -preferencesApp "${{parameters.appName}}-preferences" -storageAccountName "${{parameters.storageAccountName}}"'           

- task: AzureCLI@2
  displayName: 'Get Azure Search Query Key'
  inputs: 
    azureSubscription: '${{ parameters.principal }}'
    scriptType: ps
    scriptLocation: 'scriptPath'
    ScriptPath: '$(Pipeline.Workspace)/infra/global/getazuresearchkey.ps1'
    ScriptArguments: '${{ parameters.sharedRg }}'   