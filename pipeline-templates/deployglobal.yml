parameters:
- name: 'environment'
  type: string
  default: ''

stages:
- stage: DeployGlobal
  jobs:
  - deployment: 'shared'
    pool:
      vmImage: 'windows-latest'
    environment: ${{parameters.environment}}
    strategy:
      runOnce:
        deploy:
          steps:
                    
          - task: AzureResourceGroupDeployment@2
            displayName: 'Build Global (Search) Resources'
            inputs:
              azureSubscription: 'whitewaterfinder-sp'
              resourceGroupName: 'brgs-global' #this is a thing that needs to be addressed.
              location: '$(azureRegion)'
              csmFile: '$(Pipeline.Workspace)/infra/global-services.json'
              csmParameetersFile: 'whitewaterfinder.infrastructure/global-services-params.json'

          - task: AzureCLI@2
            displayName: 'Build Azure Search Index'
            inputs:
              azureSubscription: 'whitewaterfinder-sp'
              scriptType: ps
              scriptLocation: 'scriptPath'
              ScriptPath: '$(Pipeline.Workspace)/infra//deployment.ps1'
              ScriptArguments: 'brgs-global "$(Pipeline.Workspace)/infra/riverswithid.json"'     