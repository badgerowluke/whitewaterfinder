
trigger: 
  - trunk
  - refactor/pipeline-refactoring

stages: 
- template: 'whitewaterfinder.pipeline/provisioninfra.yml'
  parameters:
    principal: $(principal)
    providerstorage: 'tfstatewaterfinder'
    resourceGroup: $(resourceGroupDev)
    region: '$(azureRegion)'
    appName: "paddle-finder"    
    adminEmail: '$(adminEmail)'
    adminId: '$(adminId)' 
    tenant: '$(tenantId)' 
    storageAccountName: "$(resourceGroupDev)" 
    botName: 'WhiteWaterWebster'
    luisAuthoring: 'webster-luis-authoring'
    luisEndpointName: 'webster-luis'


- template: 'whitewaterfinder.pipeline/build.yml'
  parameters: 
    vstsFeed: $(artifactKey)
    
- template: 'whitewaterfinder.pipeline/configuresearch.yml'
  parameters:
    principal: $(principal)
    environment: 'production' 
    region: $(azureRegion)
    sharedRg: $(resourceGroupDev)
    artifact: infra
    

- template: 'whitewaterfinder.pipeline/deployApp.yml'
  parameters:
    stageTitle: "DevAppDeploy"
    appName: 'paddle-finder'
    resourceGroup: '$(resourceGroupDev)'
    region: '$(azureRegion)'
    botapp: 'WhiteWaterWebster'
    principal: '$(principal)'
    adminEmail: '$(adminEmail)'        